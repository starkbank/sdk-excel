
Private Sub UserForm_Initialize()
    Dim cursor As String
    Dim teams As Collection
    
    If Not isSignedin() Then
        MsgBox "Acesso negado, faça login novamente."
        Unload Me
        Exit Sub
    End If

    Do
        Set respJson = getCostCenters(cursor, New Dictionary)

        cursor = ""
        If respJson("cursor") <> "" Then
            cursor = respJson("cursor")
        End If

        Set teams = respJson("centers")

        For Each team In teams
            Me.TeamBox.AddItem team("name") + " (id = " + team("id") + ")"
        Next

    Loop While cursor <> ""

End Sub

Private Sub ConfirmButton_Click()
    'On Error Resume Next
    Dim response As Dictionary
    Dim teamInfo As String: teamInfo = TeamBox.Value
    Dim teamId As String

    Call Utils.applyStandardLayout("E")

    'Headers definition
    ActiveSheet.Cells(TableFormat.HeaderRow(), 1).Value = "Linha Digitável ou Código de Barras"
    ActiveSheet.Cells(TableFormat.HeaderRow(), 2).Value = "CPF/CNPJ do Beneficiário"
    ActiveSheet.Cells(TableFormat.HeaderRow(), 3).Value = "Data de Agendamento"
    ActiveSheet.Cells(TableFormat.HeaderRow(), 4).Value = "Descrição"
    ActiveSheet.Cells(TableFormat.HeaderRow(), 5).Value = "Tags"
    Call FreezeHeader

    If Not isSignedin() Then
        MsgBox "Acesso negado, faça login novamente."
        Unload Me
        Exit Sub
    End If

    '--------------- Create body -----------------
    Dim payload As String, tags() As String
    Dim dict As New Dictionary
    Dim payments As Collection
    
    With CreateObject("VBScript.RegExp")
        .Pattern = "\= ([^)]+)\)"
        .Global = True
        For Each M In .Execute(teamInfo)
            teamId = M.submatches(0)
        Next
    End With

    '--------------- Create payment -----------------
    Dim respMessage As String
    respMessage = V2CostCenterGateway.createChargePayments(teamId)

    Unload Me
    Exit Sub
End Sub