

Public Function generatePrivateKeySecret()
    Dim file As String
    Dim result As String
    Dim workbookPath As String: workbookPath = ActiveWorkbook.path


    file = workbookPath + "\SBEmbedded-Test\StarkBank-Utils.exe" ' TODO fix the file name after done
    result = ShellRun("""" + file + """ generatePrivateKeySecret """ + """")
    
    generatePrivateKeySecret = result
    
End Function

Public Function getPublicKeyFromSecret(secret As String)
    Dim file As String
    Dim result As String
    Dim workbookPath As String: workbookPath = ActiveWorkbook.path


    file = workbookPath + "\SBEmbedded-Test\StarkBank-Utils.exe" ' TODO fix the file name after done
    result = ShellRun("""" + file + """ getPublicKeyFromSecret """ + secret + """")
    
    getPublicKeyFromSecret = result
    
End Function

Public Function getSecretFromString(secretString As String)
    Dim file As String
    Dim result As String
    Dim workbookPath As String: workbookPath = ActiveWorkbook.path


    file = workbookPath + "\SBEmbedded-Test\StarkBank-Utils.exe" ' TODO fix the file name after done
    result = ShellRun("""" + file + """ getSecretFromString """ + secretString + """")
    x = """" + file + """ getSecretFromString """ + secretString + """"
    
    getSecretFromString = result
    
End Function

Public Function sign(message As String, secret As String)
    Dim treatedMessage As String
    Dim file As String
    Dim result As String
    Dim workbookPath As String: workbookPath = ActiveWorkbook.path

    treatedMessage = Replace(message, """", "\""")
    file = workbookPath + "\SBEmbedded-Test\StarkBank-Utils.exe" ' TODO fix the file name after done
    result = ShellRun("""" + file + """ sign  """ + treatedMessage + """" + " " + """" + secret + """")
    sign = result
    
End Function

Public Function ShellRun(shellCmd As String) As String
    Dim shell As Object
    Dim exec As Object
    Dim output As Object
    Dim result As String
    Dim resultLine As String
    
    
    Set shell = CreateObject("WScript.Shell")
    Set exec = shell.exec(shellCmd)
    Set output = exec.StdOut

    While Not output.AtEndOfStream
        resultLine = output.ReadLine
        If resultLine <> "" Then result = result & resultLine & vbCrLf
    Wend
    
    ShellRun = result

End Function
