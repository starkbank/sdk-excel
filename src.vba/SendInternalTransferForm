
Private Sub UserForm_Initialize()
    Dim cursor As String
    Dim teams As Collection
    
    If Not isSignedin() Then
        MsgBox "Acesso negado, fa√ßa login novamente."
        Unload Me
        Exit Sub
    End If
    
    AmountBox = "R$ 0,00"
    AmountBox.SelStart = 6

    Do
        Set respJson = getCostCenters(cursor, New Dictionary)

        cursor = ""
        If respJson("cursor") <> "" Then
            cursor = respJson("cursor")
        End If

        Set teams = respJson("centers")

        For Each team In teams
            Me.TeamBox.AddItem team("name") + " (id = " + team("id") + ")"
        Next

    Loop While cursor <> ""
    
'    If respJson.Exists("errors") Then
'        Unload Me
'        Exit Sub
'    End If

End Sub

Private Sub AmountBox_Change()
    AmountBox = Utils.formatCurrencyInUserForm(AmountBox)
End Sub

Private Sub ConfirmButton_Click()
    Dim teamId As String
    Dim orders As Collection
    Dim respMessage As String
    Dim teamInfo As String: teamInfo = TeamBox.Value

    Call Utils.applyStandardLayout("G")
    
    Call FreezeHeader

    'Headers definition
    Dim amount As Long: amount = CLng(Utils.clearNonNumeric(AmountBox.Value))
    Dim receiverId As String: receiverId = WorkspaceBox.Value
    Dim externalId As String: externalId = ExternalIdBox.Value
    Dim description As String: description = DescriptionBox.Value
    Dim tags() As String: tags = Split(TagsBox.Value, ",")

    If Sheets("Credentials").Cells(7, 2) <> Date Then
        ActiveSheet.Range("J10:J" & Rows.Count).ClearContents
    End If

    Sheets("Credentials").Cells(7, 2) = Date
    
    Call FreezeHeader

    With CreateObject("VBScript.RegExp")
        .Pattern = "\= ([^)]+)\)"
        .Global = True
        For Each M In .Execute(teamInfo)
            teamId = M.submatches(0)
        Next
    End With

    respMessage = V2CostCenterGateway.createInternalTransfer(teamId, amount, description, externalId, receiverId, tags())
              
    Unload Me

End Sub